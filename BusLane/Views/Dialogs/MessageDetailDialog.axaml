<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BusLane.ViewModels"
             x:Class="BusLane.Views.Dialogs.MessageDetailDialog"
             x:DataType="vm:MainWindowViewModel">
    
    <Border Classes="modal-overlay"
            IsVisible="{Binding SelectedMessage, Converter={x:Static ObjectConverters.IsNotNull}}">
        <Border Classes="modal" 
                VerticalAlignment="Center" 
                HorizontalAlignment="Center"
                MinWidth="600"
                MaxWidth="800"
                MaxHeight="700">
            <DockPanel>
                <Grid DockPanel.Dock="Top" Margin="0,0,0,16">
                    <TextBlock Text="Message Details" Classes="heading"/>
                    <StackPanel HorizontalAlignment="Right" Orientation="Horizontal" Spacing="8">
                        <!-- Resend Message Button -->
                        <Button Classes="subtle small" 
                                Command="{Binding ResendMessageCommand}"
                                CommandParameter="{Binding SelectedMessage}"
                                ToolTip.Tip="Resend this message (sends immediately with same content)">
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <PathIcon Data="{StaticResource IconSend}" Width="12" Height="12"/>
                                <TextBlock Text="Resend"/>
                            </StackPanel>
                        </Button>
                        <!-- Clone Message Button -->
                        <Button Classes="subtle small" 
                                Command="{Binding CloneMessageCommand}"
                                CommandParameter="{Binding SelectedMessage}"
                                ToolTip.Tip="Clone this message (opens send dialog with pre-filled content)">
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <PathIcon Data="{StaticResource IconEdit}" Width="12" Height="12"/>
                                <TextBlock Text="Clone"/>
                            </StackPanel>
                        </Button>
                        <Button Classes="icon" 
                                Command="{Binding ClearSelectedMessageCommand}">
                            <PathIcon Data="{StaticResource IconClose}" Width="14" Height="14"/>
                        </Button>
                    </StackPanel>
                </Grid>
                <ScrollViewer>
                    <StackPanel Spacing="12">
                        <!-- Dead Letter Info Section (only visible for dead letter messages) -->
                        <Border Classes="surface-danger" Padding="12" Margin="0,0,0,8"
                                IsVisible="{Binding SelectedMessage.DeadLetterReason, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                            <StackPanel Spacing="8">
                                <TextBlock Text="Dead Letter Information" FontWeight="Bold" Foreground="{DynamicResource TextDanger}"/>
                                <StackPanel IsVisible="{Binding SelectedMessage.DeadLetterReason, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                    <TextBlock Text="Reason" Classes="caption" Foreground="{DynamicResource TextDanger}" Margin="0,0,0,2"/>
                                    <SelectableTextBlock Text="{Binding SelectedMessage.DeadLetterReason}" TextWrapping="Wrap"/>
                                </StackPanel>
                                <StackPanel IsVisible="{Binding SelectedMessage.DeadLetterErrorDescription, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                    <TextBlock Text="Error Description" Classes="caption" Foreground="{DynamicResource TextDanger}" Margin="0,0,0,2"/>
                                    <SelectableTextBlock Text="{Binding SelectedMessage.DeadLetterErrorDescription}" TextWrapping="Wrap"/>
                                </StackPanel>
                                <StackPanel IsVisible="{Binding SelectedMessage.DeadLetterSource, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                    <TextBlock Text="Source" Classes="caption" Foreground="{DynamicResource TextDanger}" Margin="0,0,0,2"/>
                                    <SelectableTextBlock Text="{Binding SelectedMessage.DeadLetterSource}" TextWrapping="Wrap"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- Basic Message Properties -->
                        <TextBlock Text="Message Properties" Classes="body-strong" Margin="0,0,0,4"/>
                        
                        <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto">
                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,8,8">
                                <TextBlock Text="Message ID" Classes="caption" Margin="0,0,0,2"/>
                                <SelectableTextBlock Text="{Binding SelectedMessage.MessageId}" FontWeight="SemiBold" TextWrapping="Wrap"/>
                            </StackPanel>
                            <StackPanel Grid.Row="0" Grid.Column="1" Margin="8,0,0,8">
                                <TextBlock Text="Correlation ID" Classes="caption" Margin="0,0,0,2"/>
                                <SelectableTextBlock Text="{Binding SelectedMessage.CorrelationId}" TextWrapping="Wrap"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,8,8">
                                <TextBlock Text="Sequence Number" Classes="caption" Margin="0,0,0,2"/>
                                <SelectableTextBlock Text="{Binding SelectedMessage.SequenceNumber}"/>
                            </StackPanel>
                            <StackPanel Grid.Row="1" Grid.Column="1" Margin="8,0,0,8">
                                <TextBlock Text="Delivery Count" Classes="caption" Margin="0,0,0,2"/>
                                <SelectableTextBlock Text="{Binding SelectedMessage.DeliveryCount}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,8,8">
                                <TextBlock Text="Enqueued Time" Classes="caption" Margin="0,0,0,2"/>
                                <SelectableTextBlock Text="{Binding SelectedMessage.EnqueuedTime}"/>
                            </StackPanel>
                            <StackPanel Grid.Row="2" Grid.Column="1" Margin="8,0,0,8">
                                <TextBlock Text="Expires At" Classes="caption" Margin="0,0,0,2"/>
                                <SelectableTextBlock Text="{Binding SelectedMessage.ExpiresAt}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="3" Grid.Column="0" Margin="0,0,8,8"
                                        IsVisible="{Binding SelectedMessage.ScheduledEnqueueTime, Converter={x:Static ObjectConverters.IsNotNull}}">
                                <TextBlock Text="Scheduled Enqueue Time" Classes="caption" Margin="0,0,0,2"/>
                                <SelectableTextBlock Text="{Binding SelectedMessage.ScheduledEnqueueTime}"/>
                            </StackPanel>
                            <StackPanel Grid.Row="3" Grid.Column="1" Margin="8,0,0,8">
                                <TextBlock Text="Time to Live" Classes="caption" Margin="0,0,0,2"/>
                                <SelectableTextBlock Text="{Binding SelectedMessage.TimeToLive}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="4" Grid.Column="0" Margin="0,0,8,8">
                                <TextBlock Text="Content Type" Classes="caption" Margin="0,0,0,2"/>
                                <SelectableTextBlock Text="{Binding SelectedMessage.ContentType}"/>
                            </StackPanel>
                            <StackPanel Grid.Row="4" Grid.Column="1" Margin="8,0,0,8"
                                        IsVisible="{Binding SelectedMessage.SessionId, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                <TextBlock Text="Session ID" Classes="caption" Margin="0,0,0,2"/>
                                <SelectableTextBlock Text="{Binding SelectedMessage.SessionId}" TextWrapping="Wrap"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="5" Grid.Column="0" Margin="0,0,8,8"
                                        IsVisible="{Binding SelectedMessage.Subject, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                <TextBlock Text="Subject" Classes="caption" Margin="0,0,0,2"/>
                                <SelectableTextBlock Text="{Binding SelectedMessage.Subject}" TextWrapping="Wrap"/>
                            </StackPanel>
                            <StackPanel Grid.Row="5" Grid.Column="1" Margin="8,0,0,8"
                                        IsVisible="{Binding SelectedMessage.PartitionKey, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                <TextBlock Text="Partition Key" Classes="caption" Margin="0,0,0,2"/>
                                <SelectableTextBlock Text="{Binding SelectedMessage.PartitionKey}" TextWrapping="Wrap"/>
                            </StackPanel>
                        </Grid>
                        
                        <!-- Routing Properties -->
                        <StackPanel Spacing="8"
                                    IsVisible="{Binding SelectedMessage.To, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                            <TextBlock Text="Routing Properties" Classes="body-strong" Margin="0,8,0,4"/>
                            <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto">
                                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,8,8"
                                            IsVisible="{Binding SelectedMessage.To, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                    <TextBlock Text="To" Classes="caption" Margin="0,0,0,2"/>
                                    <SelectableTextBlock Text="{Binding SelectedMessage.To}" TextWrapping="Wrap"/>
                                </StackPanel>
                                <StackPanel Grid.Row="0" Grid.Column="1" Margin="8,0,0,8"
                                            IsVisible="{Binding SelectedMessage.ReplyTo, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                    <TextBlock Text="Reply To" Classes="caption" Margin="0,0,0,2"/>
                                    <SelectableTextBlock Text="{Binding SelectedMessage.ReplyTo}" TextWrapping="Wrap"/>
                                </StackPanel>
                                <StackPanel Grid.Row="1" Grid.Column="1" Margin="8,0,0,8"
                                            IsVisible="{Binding SelectedMessage.ReplyToSessionId, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                    <TextBlock Text="Reply To Session ID" Classes="caption" Margin="0,0,0,2"/>
                                    <SelectableTextBlock Text="{Binding SelectedMessage.ReplyToSessionId}" TextWrapping="Wrap"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                        
                        <!-- Application Properties -->
                        <StackPanel Spacing="8"
                                    IsVisible="{Binding FormattedApplicationProperties, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                            <TextBlock Text="Application Properties" Classes="body-strong" Margin="0,8,0,4"/>
                            <TextBox Text="{Binding FormattedApplicationProperties, Mode=OneWay}" 
                                     IsReadOnly="True"
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     MaxHeight="150"
                                     FontFamily="Cascadia Code, Consolas, Monaco, monospace"
                                     FontSize="12"
                                     Background="{DynamicResource SurfaceSubtle}"
                                     BorderThickness="0"
                                     Padding="12"
                                     CornerRadius="4"/>
                        </StackPanel>
                        
                        <!-- Message Body (at the end) -->
                        <StackPanel Margin="0,8,0,0">
                            <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,4">
                                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                                    <TextBlock Text="Body" Classes="body-strong"/>
                                    <Border Classes="badge" IsVisible="{Binding IsMessageBodyJson}">
                                        <TextBlock Text="JSON" Foreground="White" FontSize="10" FontWeight="SemiBold"/>
                                    </Border>
                                </StackPanel>
                                <Button Grid.Column="1" 
                                        Classes="subtle small"
                                        Content="Copy"
                                        Command="{Binding CopyMessageBodyCommand}"
                                        ToolTip.Tip="Copy body to clipboard"/>
                            </Grid>
                            <TextBox Text="{Binding FormattedMessageBody, Mode=OneWay}" 
                                     IsReadOnly="True"
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     MaxHeight="300"
                                     FontFamily="Cascadia Code, Consolas, Monaco, monospace"
                                     FontSize="12"
                                     Background="{DynamicResource SurfaceSubtle}"
                                     BorderThickness="0"
                                     Padding="12"
                                     CornerRadius="4"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </DockPanel>
        </Border>
    </Border>
</UserControl>

