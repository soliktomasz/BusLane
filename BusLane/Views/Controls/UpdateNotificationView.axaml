<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BusLane.ViewModels"
             x:Class="BusLane.Views.Controls.UpdateNotificationView"
             x:DataType="vm:UpdateNotificationViewModel"
             IsVisible="{Binding IsVisible}">

    <Border Background="{DynamicResource SurfaceBrand}"
            Padding="10,8"
            BorderThickness="1"
            BorderBrush="{DynamicResource BorderDefault}"
            CornerRadius="6"
            Margin="0"
            MaxWidth="520"
            HorizontalAlignment="Left">
        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8">
            <Border Grid.Column="0"
                    Width="24"
                    Height="24"
                    CornerRadius="12"
                    Background="{DynamicResource AccentSubtle}"
                    VerticalAlignment="Top">
                <LucideIcon Kind="Download" Size="12"
                            Foreground="{DynamicResource AccentBrand}"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"/>
            </Border>

            <StackPanel Grid.Column="1" Spacing="2">
                <TextBlock Text="{Binding VersionText}"
                           Classes="caption"
                           FontWeight="SemiBold"
                           MaxWidth="220"
                           TextTrimming="CharacterEllipsis"/>
                <TextBlock Text="{Binding ReleaseNotes}"
                           Classes="caption"
                           IsVisible="{Binding IsDownloading}"
                           TextTrimming="CharacterEllipsis"
                           MaxWidth="220"/>

                <!-- Download Progress -->
                <StackPanel IsVisible="{Binding IsDownloading}" Spacing="2" Margin="0,2,0,0">
                    <ProgressBar Value="{Binding DownloadProgress}"
                                 Maximum="100"
                                 Height="3"
                                 Foreground="{DynamicResource AccentBrand}"
                                 Background="{DynamicResource BorderMuted}"/>
                    <TextBlock Text="{Binding DownloadProgress, StringFormat='Downloading... {0:F0}%'}"
                               Classes="caption"/>
                </StackPanel>

                <!-- Error Message -->
                <TextBlock IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                           Text="{Binding ErrorMessage}"
                           Classes="caption"
                           Foreground="{DynamicResource TextDanger}"
                           Margin="0,2,0,0"
                           MaxWidth="220"
                           TextTrimming="CharacterEllipsis"/>
            </StackPanel>

            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                <!-- Install Now / Restart Button -->
                <Button Classes="primary small"
                        Command="{Binding InstallNowCommand}"
                        IsVisible="{Binding !IsDownloaded}">
                    <TextBlock Text="Install"/>
                </Button>
                <Button Classes="primary small"
                        Command="{Binding InstallNowCommand}"
                        IsVisible="{Binding IsDownloaded}">
                    <TextBlock Text="Restart"/>
                </Button>

                <!-- Retry Button (on error) -->
                <Button Classes="secondary small"
                        Command="{Binding RetryCommand}"
                        IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                    <TextBlock Text="Retry"/>
                </Button>

                <!-- Later Button -->
                <Button Classes="secondary small"
                        Command="{Binding RemindLaterCommand}"
                        IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNullOrEmpty}}">
                    <TextBlock Text="Later"/>
                </Button>

                <!-- Dismiss Button -->
                <Button Classes="subtle small"
                        Command="{Binding DismissCommand}"
                        Padding="4">
                    <LucideIcon Kind="X" Size="14"/>
                </Button>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
