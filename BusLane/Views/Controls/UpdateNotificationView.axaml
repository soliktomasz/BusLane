<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BusLane.ViewModels"
             x:Class="BusLane.Views.Controls.UpdateNotificationView"
             x:DataType="vm:UpdateNotificationViewModel"
             IsVisible="{Binding IsVisible}">

    <Border Background="{DynamicResource SurfaceBrand}"
            Padding="16,14"
            BorderThickness="1"
            BorderBrush="{DynamicResource BorderDefault}"
            CornerRadius="8"
            Margin="24,8,24,0"
            MaxWidth="960"
            HorizontalAlignment="Left">
        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
            <Border Grid.Column="0"
                    Width="32"
                    Height="32"
                    CornerRadius="16"
                    Background="{DynamicResource AccentSubtle}"
                    VerticalAlignment="Top">
                <LucideIcon Kind="Download" Size="16"
                            Foreground="{DynamicResource AccentBrand}"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"/>
            </Border>

            <StackPanel Grid.Column="1" Spacing="4">
                <TextBlock Text="{Binding VersionText}"
                           Classes="body-strong"/>
                <TextBlock Text="{Binding ReleaseNotes}"
                           Classes="caption"
                           TextTrimming="CharacterEllipsis"
                           MaxWidth="560"/>

                <!-- Download Progress -->
                <StackPanel IsVisible="{Binding IsDownloading}" Spacing="4" Margin="0,4,0,0">
                    <ProgressBar Value="{Binding DownloadProgress}"
                                 Maximum="100"
                                 Height="4"
                                 Foreground="{DynamicResource AccentBrand}"
                                 Background="{DynamicResource BorderMuted}"/>
                    <TextBlock Text="{Binding DownloadProgress, StringFormat='Downloading... {0:F0}%'}"
                               Classes="caption"/>
                </StackPanel>

                <!-- Error Message -->
                <TextBlock IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                           Text="{Binding ErrorMessage}"
                           Classes="caption"
                           Foreground="{DynamicResource TextDanger}"
                           Margin="0,4,0,0"/>
            </StackPanel>

            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Top">
                <!-- Install Now / Restart Button -->
                <Button Classes="primary small"
                        Command="{Binding InstallNowCommand}"
                        IsVisible="{Binding !IsDownloaded}">
                    <TextBlock Text="Install"/>
                </Button>
                <Button Classes="primary small"
                        Command="{Binding InstallNowCommand}"
                        IsVisible="{Binding IsDownloaded}">
                    <TextBlock Text="Restart"/>
                </Button>

                <!-- Retry Button (on error) -->
                <Button Classes="secondary small"
                        Command="{Binding RetryCommand}"
                        IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                    <TextBlock Text="Retry"/>
                </Button>

                <!-- Later Button -->
                <Button Classes="secondary small"
                        Command="{Binding RemindLaterCommand}"
                        IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNullOrEmpty}}">
                    <TextBlock Text="Later"/>
                </Button>

                <!-- Skip Button -->
                <Button Classes="subtle small"
                        Command="{Binding SkipVersionCommand}"
                        IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNullOrEmpty}}">
                    <TextBlock Text="Skip"/>
                </Button>

                <!-- Dismiss Button -->
                <Button Classes="subtle"
                        Command="{Binding DismissCommand}"
                        Padding="4">
                    <LucideIcon Kind="X" Size="14" Foreground="White"/>
                </Button>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
