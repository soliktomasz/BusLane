<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BusLane.ViewModels"
             xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
             x:Class="BusLane.Views.Controls.ChartsView"
             x:DataType="vm:ChartsViewModel">
    
    <Border Classes="card" Padding="0">
        <Grid RowDefinitions="Auto,*">
            <!-- Header -->
            <Border Grid.Row="0" BorderBrush="{DynamicResource BorderDefault}" BorderThickness="0,0,0,1" Padding="16">
                <Grid ColumnDefinitions="*,Auto">
                    <TextBlock Grid.Column="0" Text="Metrics &amp; Charts" Classes="heading" VerticalAlignment="Center"/>
                    
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12">
                        <!-- Time range selector -->
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="Time Range:" VerticalAlignment="Center" FontSize="13"/>
                            <ComboBox ItemsSource="{Binding AvailableTimeRanges}"
                                      SelectedItem="{Binding SelectedTimeRange}"
                                      MinWidth="120"/>
                        </StackPanel>
                        
                        <CheckBox Content="Aggregated" IsChecked="{Binding ShowAggregated}" VerticalAlignment="Center"/>
                        
                        <Button Classes="subtle small" Content="â†» Refresh" 
                                Command="{Binding RefreshChartsCommand}"
                                Padding="8,6"/>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- Charts Grid -->
            <ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
                <Grid RowDefinitions="Auto,Auto,Auto" Margin="16">
                    
                    <!-- Message Count Over Time -->
                    <Border Grid.Row="0" Classes="card" Padding="16" Margin="0,0,0,16">
                        <Grid RowDefinitions="Auto,300">
                            <TextBlock Grid.Row="0" Text="Active Messages Over Time" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,12"/>
                            <lvc:CartesianChart Grid.Row="1"
                                                Series="{Binding MessageCountSeries}"
                                                XAxes="{Binding MessageCountXAxes}"
                                                YAxes="{Binding MessageCountYAxes}"
                                                ZoomMode="X"
                                                TooltipPosition="Top"/>
                        </Grid>
                    </Border>
                    
                    <!-- Dead Letter Count Over Time -->
                    <Border Grid.Row="1" Classes="card" Padding="16" Margin="0,0,0,16">
                        <Grid RowDefinitions="Auto,300">
                            <TextBlock Grid.Row="0" Text="Dead Letters Over Time" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,12"/>
                            <lvc:CartesianChart Grid.Row="1"
                                                Series="{Binding DeadLetterSeries}"
                                                XAxes="{Binding DeadLetterXAxes}"
                                                YAxes="{Binding DeadLetterYAxes}"
                                                ZoomMode="X"
                                                TooltipPosition="Top"/>
                        </Grid>
                    </Border>
                    
                    <!-- Distribution and Comparison Charts -->
                    <Grid Grid.Row="2" ColumnDefinitions="*,*">
                        <!-- Entity Distribution Pie Chart -->
                        <Border Grid.Column="0" Classes="card" Padding="16" Margin="0,0,8,0">
                            <Grid RowDefinitions="Auto,300">
                                <TextBlock Grid.Row="0" Text="Message Distribution (Top 10)" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,12"/>
                                <lvc:PieChart Grid.Row="1"
                                              Series="{Binding EntityDistributionSeries}"
                                              LegendPosition="Right"
                                              TooltipPosition="Center"/>
                            </Grid>
                        </Border>
                        
                        <!-- Comparison Bar Chart -->
                        <Border Grid.Column="1" Classes="card" Padding="16" Margin="8,0,0,0">
                            <Grid RowDefinitions="Auto,300">
                                <TextBlock Grid.Row="0" Text="Entity Comparison (Top 10)" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,12"/>
                                <lvc:CartesianChart Grid.Row="1"
                                                    Series="{Binding ComparisonSeries}"
                                                    XAxes="{Binding ComparisonXAxes}"
                                                    YAxes="{Binding ComparisonYAxes}"
                                                    TooltipPosition="Top"/>
                            </Grid>
                        </Border>
                    </Grid>
                </Grid>
            </ScrollViewer>
        </Grid>
    </Border>
</UserControl>

