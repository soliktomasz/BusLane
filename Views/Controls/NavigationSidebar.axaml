<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BusLane.ViewModels"
             xmlns:models="using:BusLane.Models"
             x:Class="BusLane.Views.Controls.NavigationSidebar"
             x:DataType="vm:MainWindowViewModel">
    
    <Border Classes="sidebar">
        <DockPanel>
            <!-- App Header -->
            <StackPanel DockPanel.Dock="Top" Margin="16,20,16,12">
                <TextBlock Text="Bus Lane" Classes="title"/>
                <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,4,0,0">
                    <TextBlock Text="Service Bus Manager" Classes="caption"/>
                    <TextBlock Text="{Binding AppVersion}" Classes="caption" Foreground="#0F6CBD"/>
                </StackPanel>
            </StackPanel>
            
            <Separator DockPanel.Dock="Top" Margin="16,0"/>
            
            <!-- Action Buttons -->
            <StackPanel DockPanel.Dock="Top" Margin="12,12,12,12" Spacing="8">
                <!-- Connection Library Button (always visible) -->
                <Button Classes="primary" 
                        Content="My Connections"
                        Command="{Binding OpenConnectionLibraryCommand}"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"/>
                
                <!-- Azure Sign In (when not authenticated and not using connection string) -->
                <Button Classes="secondary" 
                        Content="Sign in with Azure"
                        Command="{Binding LoginCommand}"
                        IsVisible="{Binding !IsAuthenticated}"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"/>
                
                <!-- Sign Out (when authenticated with Azure) -->
                <Button Classes="secondary" 
                        Content="Sign Out"
                        Command="{Binding LogoutCommand}"
                        IsVisible="{Binding IsAuthenticated}"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"/>
            </StackPanel>
            
            <!-- Settings Button - Docked to bottom -->
            <Button DockPanel.Dock="Bottom"
                    Classes="subtle" 
                    Command="{Binding OpenSettingsCommand}"
                    HorizontalAlignment="Stretch"
                    Margin="12,8,12,12"
                    Padding="12,8">
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <TextBlock Text="âš™" FontSize="16" VerticalAlignment="Center"/>
                    <TextBlock Text="Settings" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
            
            <!-- Active Connection Card (when using connection string) - Docked to bottom -->
            <Border DockPanel.Dock="Bottom" Margin="12,12,12,16"
                    IsVisible="{Binding ActiveConnection, Converter={x:Static ObjectConverters.IsNotNull}}"
                    Classes="card" Padding="0">
                <StackPanel>
                    <!-- Connection Info -->
                    <Border Background="#FAFAFA" CornerRadius="8,8,0,0" Padding="16,12" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                        <StackPanel>
                            <TextBlock Text="Connected to" Classes="caption"/>
                            <TextBlock Text="{Binding ActiveConnection.Name}" 
                                       FontWeight="SemiBold" 
                                       FontSize="14" 
                                       Margin="0,4,0,0"/>
                            <TextBlock Text="{Binding ActiveConnection.EntityName}" 
                                       Classes="caption" 
                                       Margin="0,2,0,0"
                                       IsVisible="{Binding ActiveConnection.EntityName, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                            
                            <!-- Dead Letter Count Badge -->
                            <Border Classes="badge-danger" Padding="8,4" Margin="0,8,0,0"
                                    HorizontalAlignment="Left"
                                    IsVisible="{Binding HasDeadLetters}">
                                <TextBlock Text="{Binding TotalDeadLetterCount, StringFormat='{}{0} Dead Letters'}"
                                           Foreground="White" FontSize="11" FontWeight="SemiBold"/>
                            </Border>
                        </StackPanel>
                    </Border>
                    
                    <!-- Disconnect Button -->
                    <Button Classes="danger-outline" 
                            Content="Disconnect"
                            Command="{Binding DisconnectConnectionCommand}"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            Margin="12"
                            Padding="12,6"/>
                </StackPanel>
            </Border>
            
            <!-- Subscription Picker -->
            <StackPanel DockPanel.Dock="Top" Margin="12,0,12,12"
                        IsVisible="{Binding IsAuthenticated}">
                <TextBlock Text="Subscription" Classes="caption" Margin="4,0,0,6"/>
                <ComboBox ItemsSource="{Binding Subscriptions}"
                          SelectedItem="{Binding SelectedAzureSubscription}"
                          HorizontalAlignment="Stretch">
                    <ComboBox.ItemTemplate>
                        <DataTemplate x:DataType="models:AzureSubscription">
                            <TextBlock Text="{Binding Name}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
            </StackPanel>
            
            <!-- Namespaces Section -->
            <TextBlock DockPanel.Dock="Top" Text="Namespaces" 
                       Classes="body-strong" Margin="16,8,0,8"
                       IsVisible="{Binding IsAuthenticated}"/>
            
            <ScrollViewer IsVisible="{Binding IsAuthenticated}">
                <ListBox ItemsSource="{Binding Namespaces}"
                         Margin="8,0">
                    <ListBox.ItemTemplate>
                        <DataTemplate x:DataType="models:ServiceBusNamespace">
                            <StackPanel>
                                <Button Classes="subtle" 
                                        Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).SelectNamespaceCommand}"
                                        CommandParameter="{Binding}"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Left"
                                        Padding="8,6">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="13"/>
                                        <TextBlock Text="{Binding Location}" Classes="caption" FontSize="11" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </ScrollViewer>
        </DockPanel>
    </Border>
</UserControl>

