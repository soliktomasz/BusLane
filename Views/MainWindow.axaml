<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:BusLane.ViewModels"
        xmlns:controls="using:BusLane.Views.Controls"
        xmlns:dialogs="using:BusLane.Views.Dialogs"
        x:Class="BusLane.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Bus Lane - Service Bus Manager"
        Width="1280" Height="800"
        MinWidth="1000" MinHeight="600"
        WindowStartupLocation="CenterScreen">
    
    <Grid ColumnDefinitions="Auto,*">
        <!-- Navigation Pane (Fluent 2 Sidebar) -->
        <controls:NavigationSidebar Grid.Column="0"/>
        
        <!-- Main Content -->
        <Grid Grid.Column="1" Margin="24,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Welcome / Not Connected -->
            <controls:WelcomeView Grid.Row="1" 
                                  VerticalAlignment="Center" 
                                  HorizontalAlignment="Center"/>
            
            <!-- Content when namespace selected (Azure mode) -->
            <Grid Grid.Row="0" Grid.RowSpan="2" 
                  IsVisible="{Binding SelectedNamespace, Converter={x:Static ObjectConverters.IsNotNull}}"
                  RowDefinitions="Auto,*">
                
                <!-- Header -->
                <Grid Grid.Row="0" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="{Binding SelectedNamespace.Name}" Classes="title"/>
                        <TextBlock Text="{Binding SelectedNamespace.ResourceGroup}" Classes="caption" Margin="0,4,0,0"/>
                    </StackPanel>
                    <Button Classes="secondary small" Content="Refresh" 
                            Command="{Binding RefreshCommand}"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"/>
                </Grid>
                
                <!-- Main content grid -->
                <Grid Grid.Row="1" ColumnDefinitions="1.2*,1.8*">
                    <!-- Service Bus Tree View -->
                    <controls:AzureEntityTreeView Grid.Column="0" Margin="0,0,12,0"/>
                    
                    <!-- Messages Panel -->
                    <controls:MessagesPanelView Grid.Column="1" Margin="12,0,0,0"/>
                </Grid>
            </Grid>
            
            <!-- Content when connected via connection string -->
            <Grid Grid.Row="0" Grid.RowSpan="2" 
                  IsVisible="{Binding ActiveConnection, Converter={x:Static ObjectConverters.IsNotNull}}"
                  RowDefinitions="Auto,*">
                
                <!-- Header -->
                <Grid Grid.Row="0" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="{Binding ActiveConnection.Name}" Classes="title"/>
                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,6,0,0">
                            <Border Classes="badge-info" Padding="8,4">
                                <TextBlock Text="{Binding ActiveConnection.TypeDisplayName}" FontSize="12" Foreground="#0F6CBD"/>
                            </Border>
                            <TextBlock Text="{Binding ActiveConnection.EntityName}" Classes="caption" VerticalAlignment="Center"
                                       IsVisible="{Binding ActiveConnection.EntityName, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                            <TextBlock Text="{Binding ActiveConnection.Endpoint}" Classes="caption" VerticalAlignment="Center"
                                       IsVisible="{Binding ActiveConnection.IsNamespaceLevel}"/>
                        </StackPanel>
                    </StackPanel>
                    <Button Classes="secondary small" Content="Refresh" 
                            Command="{Binding RefreshConnectionCommand}"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"/>
                </Grid>
                
                <!-- Main content for connection string mode -->
                <Grid Grid.Row="1" ColumnDefinitions="1.2*,1.8*">
                    <!-- Entity Tree for connection string mode -->
                    <controls:EntityTreeView Grid.Column="0" Margin="0,0,12,0"/>
                    
                    <!-- Messages Panel (reusing same structure as Azure mode) -->
                    <controls:MessagesPanelView Grid.Column="1" Margin="12,0,0,0"/>
                </Grid>
            </Grid>
            
            <!-- Status Bar -->
            <Border Grid.Row="2" Margin="0,12,0,0">
                <Grid ColumnDefinitions="Auto,*">
                    <ProgressBar Grid.Column="0" 
                                 IsIndeterminate="True" 
                                 IsVisible="{Binding IsLoading}"
                                 Width="100" Height="3"/>
                    <Button Grid.Column="1" 
                            Classes="subtle"
                            Command="{Binding ToggleStatusPopupCommand}"
                            HorizontalAlignment="Left"
                            Margin="12,0"
                            Padding="8,4"
                            Cursor="Hand"
                            ToolTip.Tip="Click to see full message">
                        <TextBlock Text="{Binding StatusMessage}" 
                                   Classes="caption"
                                   TextTrimming="CharacterEllipsis"
                                   MaxWidth="400"/>
                    </Button>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Modal Dialogs -->
        <dialogs:StatusPopupDialog Grid.Column="0" Grid.ColumnSpan="2"/>
        <dialogs:MessageDetailDialog Grid.Column="0" Grid.ColumnSpan="2"/>
        <dialogs:SendMessageDialog Grid.Column="0" Grid.ColumnSpan="2"/>
        <dialogs:SaveMessageDialog Grid.Column="0" Grid.ColumnSpan="2"/>
        <dialogs:LoadMessageDialog Grid.Column="0" Grid.ColumnSpan="2"/>
        <dialogs:ConnectionLibraryDialog Grid.Column="0" Grid.ColumnSpan="2"/>
        <dialogs:SettingsDialog Grid.Column="0" Grid.ColumnSpan="2"/>
    </Grid>
</Window>

